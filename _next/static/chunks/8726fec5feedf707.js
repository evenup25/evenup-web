(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,33525,(e,t,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),Object.defineProperty(s,"warnOnce",{enumerable:!0,get:function(){return l}});let l=e=>{}},79474,(e,t,s)=>{"use strict";var l=e.r(71645).__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;s.c=function(e){return l.H.useMemoCache(e)}},932,(e,t,s)=>{"use strict";t.exports=e.r(79474)},32076,e=>{"use strict";var t=e.i(43476),s=e.i(932),l=e.i(71645),a=e.i(53210),r=e.i(617);let n=["viewer","admin","owner"];function i(){let e,i,b,_,f,y,j,g,N,S,v,w,k,R,C,T,U,A,O,D,E,L,I,P,q,$,M,B,H,K,F,G,W,Y,z,J,Q,V,X,Z,ee,et=(0,s.c)(86);et[0]===Symbol.for("react.memo_cache_sentinel")?(e=[],et[0]=e):e=et[0];let[es,el]=(0,l.useState)(e);et[1]===Symbol.for("react.memo_cache_sentinel")?(i={},et[1]=i):i=et[1];let[ea,er]=(0,l.useState)(i),[en,ei]=(0,l.useState)(!0),[ed,ec]=(0,l.useState)(null),[eo,em]=(0,l.useState)(null),[eu,ex]=(0,l.useState)(""),[ep,eh]=(0,l.useState)("viewer"),[eb,e_]=(0,l.useState)(!1),[ef,ey]=(0,l.useState)(null),[ej,eg]=(0,l.useState)(null),[eN,eS]=(0,l.useState)("");et[2]===Symbol.for("react.memo_cache_sentinel")?(b=[],et[2]=b):b=et[2];let[ev,ew]=(0,l.useState)(b),[ek,eR]=(0,l.useState)(!1),[eC,eT]=(0,l.useState)(!1);et[3]===Symbol.for("react.memo_cache_sentinel")?(_={},et[3]=_):_=et[3];let[eU,eA]=(0,l.useState)(_);et[4]===Symbol.for("react.memo_cache_sentinel")?(f=async()=>{ei(!0),ec(null);let{data:e,error:t}=await a.supabase.from("admin_user_roles").select("user_id,role,created_at,updated_at").order("updated_at",{ascending:!1});if(t){ec(t.message),ei(!1);return}let s=(e??[]).filter(p);el(s),eA(s.reduce(x,{}));let l=s.map(u);if(0===l.length){er({}),ei(!1);return}let{data:r,error:n}=await a.supabase.from("user_profiles").select("id,email,nickname,status,deleted_at,last_active_at").in("id",l);if(n){ec(n.message),ei(!1);return}er((r??[]).reduce(m,{})),ei(!1)},et[4]=f):f=et[4];let eO=f;et[5]===Symbol.for("react.memo_cache_sentinel")?(y=()=>{let e=window.setTimeout(()=>{eO()},0);return()=>{window.clearTimeout(e)}},j=[eO],et[5]=y,et[6]=j):(y=et[5],j=et[6]),(0,l.useEffect)(y,j),et[7]!==eN?(g=()=>{let e=eN.trim();if(e.length<2)return;let t=!1,s=setTimeout(async()=>{eR(!0);let s=e.replaceAll(","," ").replaceAll("%",""),{data:l,error:r}=await a.supabase.from("user_profiles").select("id,email,nickname,status,deleted_at,last_active_at").or(`email.ilike.%${s}%,nickname.ilike.%${s}%`).limit(8);if(!t){if(r){ec(r.message),ew([]),eR(!1);return}ew(l??[]),eR(!1)}},300);return()=>{t=!0,clearTimeout(s)}},N=[eN],et[7]=eN,et[8]=g,et[9]=N):(g=et[8],N=et[9]),(0,l.useEffect)(g,N);let eD=es.length;et[10]!==es?(S=new Set(es.map(o)),et[10]=es,et[11]=S):S=et[11];let eE=S;if(et[12]!==eE||et[13]!==ev){let e;et[15]!==eE?(e=e=>!eE.has(e.id),et[15]=eE,et[16]=e):e=et[16],v=ev.filter(e),et[12]=eE,et[13]=ev,et[14]=v}else v=et[14];let eL=v;et[17]!==ep||et[18]!==eu?(w=async()=>{let e=eu.trim();if(!e)return void ec("User ID is required.");e_(!0),ec(null),em(null);let{error:t}=await a.supabase.from("admin_user_roles").upsert({user_id:e,role:ep},{onConflict:"user_id"});if(t){ec(t.message),e_(!1);return}em("Role saved successfully."),ex(""),eS(""),ew([]),eT(!1),e_(!1),await eO()},et[17]=ep,et[18]=eu,et[19]=w):w=et[19];let eI=w;et[20]!==eU?(k=async e=>{let t=eU[e.user_id]??e.role;if(t===e.role)return;ey(e.user_id),ec(null),em(null);let{error:s}=await a.supabase.from("admin_user_roles").update({role:t}).eq("user_id",e.user_id);if(s){ec(s.message),ey(null);return}em(`Role updated to ${t}.`),ey(null),await eO()},et[20]=eU,et[21]=k):k=et[21];let eP=k;et[22]===Symbol.for("react.memo_cache_sentinel")?(R=async e=>{if(!window.confirm("Are you sure you want to revoke this user's admin access?"))return;eg(e),ec(null),em(null);let{error:t}=await a.supabase.from("admin_user_roles").delete().eq("user_id",e);if(t){ec(t.message),eg(null);return}em(`Role removed for ${e}.`),eg(null),await eO()},et[22]=R):R=et[22];let eq=R;et[23]===Symbol.for("react.memo_cache_sentinel")?(C=(0,t.jsx)("h2",{className:"text-base font-semibold text-slate-900",children:"Assign role"}),T=(0,t.jsx)("p",{className:"mt-1 text-sm text-slate-600",children:"Search users by email or nickname, then assign one of the admin roles."}),et[23]=C,et[24]=T):(C=et[23],T=et[24]),et[25]===Symbol.for("react.memo_cache_sentinel")?(U=(0,t.jsx)("span",{children:"User search"}),et[25]=U):U=et[25],et[26]===Symbol.for("react.memo_cache_sentinel")?(A=e=>{let t=e.target.value;eS(t),eT(t.trim().length>=2),t.trim().length<2&&(eR(!1),ew([]))},et[26]=A):A=et[26],et[27]!==eN?(O=()=>eT(eN.trim().length>=2),et[27]=eN,et[28]=O):O=et[28],et[29]!==O||et[30]!==eN?(D=(0,t.jsxs)("label",{className:"space-y-1 text-sm text-slate-700",children:[U,(0,t.jsx)("input",{type:"text",value:eN,onChange:A,onFocus:O,placeholder:"name or email",className:"w-full rounded-lg border border-slate-300 px-3 py-2 text-sm"})]}),et[29]=O,et[30]=eN,et[31]=D):D=et[31],et[32]===Symbol.for("react.memo_cache_sentinel")?(E=(0,t.jsx)("span",{children:"Role"}),et[32]=E):E=et[32],et[33]===Symbol.for("react.memo_cache_sentinel")?(L=e=>eh(e.target.value),et[33]=L):L=et[33],et[34]===Symbol.for("react.memo_cache_sentinel")?(I=n.map(c),et[34]=I):I=et[34],et[35]!==ep?(P=(0,t.jsxs)("label",{className:"space-y-1 text-sm text-slate-700",children:[E,(0,t.jsx)("select",{value:ep,onChange:L,className:"w-full rounded-lg border border-slate-300 px-3 py-2 text-sm",children:I})]}),et[35]=ep,et[36]=P):P=et[36],et[37]!==D||et[38]!==P?(q=(0,t.jsxs)("div",{className:"mt-4 grid gap-3 sm:grid-cols-2",children:[D,P]}),et[37]=D,et[38]=P,et[39]=q):q=et[39],et[40]!==eC||et[41]!==ek||et[42]!==eN||et[43]!==eL?($=eC&&eN.trim().length>=2?(0,t.jsx)("div",{className:"mt-3 rounded-lg border border-slate-200 bg-white p-2",children:ek?(0,t.jsx)("p",{className:"px-2 py-1 text-xs text-slate-500",children:"Searching users..."}):0===eL.length?(0,t.jsx)("p",{className:"px-2 py-1 text-xs text-slate-500",children:"No users found."}):(0,t.jsx)("ul",{className:"space-y-1",children:eL.map(e=>(0,t.jsx)("li",{children:(0,t.jsxs)("button",{type:"button",className:"w-full rounded-md px-2 py-2 text-left text-sm hover:bg-slate-100",onClick:()=>{ex(e.id),eS(e.email??e.nickname??e.id),eR(!1),ew([]),eT(!1)},children:[(0,t.jsx)("p",{className:"font-medium text-slate-800",children:e.email??e.nickname??"-"}),(0,t.jsx)("p",{className:"text-xs text-slate-500",children:e.id})]})},e.id))})}):null,et[40]=eC,et[41]=ek,et[42]=eN,et[43]=eL,et[44]=$):$=et[44],et[45]===Symbol.for("react.memo_cache_sentinel")?(M=(0,t.jsx)("span",{children:"User ID (UUID)"}),et[45]=M):M=et[45],et[46]===Symbol.for("react.memo_cache_sentinel")?(B=e=>ex(e.target.value),et[46]=B):B=et[46],et[47]!==eu?(H=(0,t.jsxs)("label",{className:"mt-3 block space-y-1 text-sm text-slate-700",children:[M,(0,t.jsx)("input",{type:"text",value:eu,onChange:B,placeholder:"00000000-0000-0000-0000-000000000000",className:"w-full rounded-lg border border-slate-300 px-3 py-2 text-sm"})]}),et[47]=eu,et[48]=H):H=et[48],et[49]!==eI?(K=()=>void eI(),et[49]=eI,et[50]=K):K=et[50];let e$=eb?"Saving...":"Save role";return et[51]!==eb||et[52]!==K||et[53]!==e$?(F=(0,t.jsx)("div",{className:"mt-3",children:(0,t.jsx)("button",{type:"button",onClick:K,disabled:eb,className:"rounded-lg bg-slate-900 px-4 py-2 text-sm text-white hover:bg-slate-800 disabled:cursor-not-allowed disabled:opacity-70",children:e$})}),et[51]=eb,et[52]=K,et[53]=e$,et[54]=F):F=et[54],et[55]!==q||et[56]!==$||et[57]!==H||et[58]!==F?(G=(0,t.jsxs)("div",{className:"rounded-xl border border-slate-200 bg-slate-50 p-4",children:[C,T,q,$,H,F]}),et[55]=q,et[56]=$,et[57]=H,et[58]=F,et[59]=G):G=et[59],et[60]!==ed?(W=ed?(0,t.jsx)("p",{className:"rounded-lg border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-700",children:ed}):null,et[60]=ed,et[61]=W):W=et[61],et[62]!==eo?(Y=eo?(0,t.jsx)("p",{className:"rounded-lg border border-emerald-200 bg-emerald-50 px-3 py-2 text-sm text-emerald-700",children:eo}):null,et[62]=eo,et[63]=Y):Y=et[63],et[64]===Symbol.for("react.memo_cache_sentinel")?(z=(0,t.jsx)("h3",{className:"text-sm font-semibold text-slate-900",children:"Assigned roles"}),et[64]=z):z=et[64],et[65]!==eD?(J=(0,t.jsxs)("div",{className:"flex items-center justify-between border-b border-slate-200 px-4 py-3",children:[z,(0,t.jsxs)("span",{className:"text-xs text-slate-500",children:[eD," assignments"]})]}),et[65]=eD,et[66]=J):J=et[66],et[67]===Symbol.for("react.memo_cache_sentinel")?(Q=(0,t.jsx)("thead",{className:"bg-slate-100 text-slate-700",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"px-3 py-2",children:"User"}),(0,t.jsx)("th",{className:"px-3 py-2",children:"Role"}),(0,t.jsx)("th",{className:"px-3 py-2",children:"Status"}),(0,t.jsx)("th",{className:"px-3 py-2",children:"Last active"}),(0,t.jsx)("th",{className:"px-3 py-2",children:"Updated"}),(0,t.jsx)("th",{className:"px-3 py-2",children:"Action"})]})}),et[67]=Q):Q=et[67],et[68]!==eP||et[69]!==en||et[70]!==ea||et[71]!==ej||et[72]!==eU||et[73]!==es||et[74]!==ef?(V=en?(0,t.jsx)("tr",{children:(0,t.jsx)("td",{className:"px-3 py-3 text-slate-500",colSpan:6,children:"Loading roles..."})}):0===es.length?(0,t.jsx)("tr",{children:(0,t.jsx)("td",{className:"px-3 py-3 text-slate-500",colSpan:6,children:"No admin roles assigned yet."})}):es.map(e=>{let s=ea[e.user_id];return(0,t.jsxs)("tr",{className:"border-t border-slate-200",children:[(0,t.jsxs)("td",{className:"px-3 py-2",children:[(0,t.jsx)("p",{className:"font-medium text-slate-800",children:s?.email??s?.nickname??"-"}),(0,t.jsx)("p",{className:"text-xs text-slate-500",children:e.user_id})]}),(0,t.jsx)("td",{className:"px-3 py-2",children:(0,t.jsx)(h,{role:e.role})}),(0,t.jsx)("td",{className:"px-3 py-2 text-slate-700",children:s?.status??"-"}),(0,t.jsx)("td",{className:"px-3 py-2 text-slate-700",children:s?.last_active_at?new Date(s.last_active_at).toLocaleString():"-"}),(0,t.jsx)("td",{className:"px-3 py-2 text-slate-700",children:new Date(e.updated_at).toLocaleString()}),(0,t.jsx)("td",{className:"px-3 py-2",children:(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,t.jsx)("select",{value:eU[e.user_id]??e.role,onChange:t=>{let s=t.target.value;eA(t=>({...t,[e.user_id]:s}))},className:"rounded-md border border-slate-300 px-2 py-1 text-xs text-slate-700",children:n.map(d)}),(0,t.jsx)("button",{type:"button",className:"rounded-md border border-slate-300 px-2 py-1 text-xs text-slate-700 hover:bg-slate-100 disabled:cursor-not-allowed disabled:opacity-60",disabled:ef===e.user_id||(eU[e.user_id]??e.role)===e.role,onClick:()=>void eP(e),children:ef===e.user_id?"Updating...":"Update"}),(0,t.jsx)("button",{type:"button",className:"rounded-md border border-red-200 px-2 py-1 text-xs text-red-700 hover:bg-red-50 disabled:cursor-not-allowed disabled:opacity-60",disabled:ej===e.user_id,onClick:()=>void eq(e.user_id),children:ej===e.user_id?"Revoking...":"Revoke"})]})})]},e.user_id)}),et[68]=eP,et[69]=en,et[70]=ea,et[71]=ej,et[72]=eU,et[73]=es,et[74]=ef,et[75]=V):V=et[75],et[76]!==V?(X=(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{className:"min-w-full text-left text-sm",children:[Q,(0,t.jsx)("tbody",{children:V})]})}),et[76]=V,et[77]=X):X=et[77],et[78]!==J||et[79]!==X?(Z=(0,t.jsxs)("div",{className:"rounded-xl border border-slate-200",children:[J,X]}),et[78]=J,et[79]=X,et[80]=Z):Z=et[80],et[81]!==G||et[82]!==W||et[83]!==Y||et[84]!==Z?(ee=(0,t.jsx)(r.default,{pageTitle:"Role Management",pageDescription:"Assign who can access the admin portal.",requiredRole:"admin",children:(0,t.jsxs)("div",{className:"space-y-5",children:[G,W,Y,Z]})}),et[81]=G,et[82]=W,et[83]=Y,et[84]=Z,et[85]=ee):ee=et[85],ee}function d(e){return(0,t.jsx)("option",{value:e,children:e},e)}function c(e){return(0,t.jsx)("option",{value:e,children:e},e)}function o(e){return e.user_id}function m(e,t){return e[t.id]=t,e}function u(e){return e.user_id}function x(e,t){return e[t.user_id]=t.role,e}function p(e){return n.includes(e.role)}function h(e){let l,a=(0,s.c)(3),{role:r}=e;if("owner"===r){let e;return a[0]===Symbol.for("react.memo_cache_sentinel")?(e=(0,t.jsx)("span",{className:"rounded-md bg-violet-100 px-2 py-1 text-xs font-semibold text-violet-700",children:"owner"}),a[0]=e):e=a[0],e}if("admin"===r){let e;return a[1]===Symbol.for("react.memo_cache_sentinel")?(e=(0,t.jsx)("span",{className:"rounded-md bg-sky-100 px-2 py-1 text-xs font-semibold text-sky-700",children:"admin"}),a[1]=e):e=a[1],e}return a[2]===Symbol.for("react.memo_cache_sentinel")?(l=(0,t.jsx)("span",{className:"rounded-md bg-slate-100 px-2 py-1 text-xs font-semibold text-slate-700",children:"viewer"}),a[2]=l):l=a[2],l}e.s(["default",()=>i])}]);